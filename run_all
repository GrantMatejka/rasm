ROOT_DIR=$(pwd)

for FILE in test_programs/*.rkt; do 
  echo ""
  echo "******* Compiling: $FILE ******"
  racket compiler.rkt $FILE
done

cp $ROOT_DIR/root_index.js $ROOT_DIR/out/index.js

cd $ROOT_DIR/out/

for FILE in *.wat; do 
  echo ""
  echo "******* Running: $FILE ******"

  wat2wasm $FILE -o a.wasm
  node index.js

  # cleanup
  rm a.wasm $FILE
done

cd $ROOT_DIR
